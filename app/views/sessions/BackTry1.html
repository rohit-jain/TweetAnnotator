<html>
<head>
<style type='text/css'>

</style>

<script type="text/javascript">

var BAR_HEIGHT=50;
var topOffset=50;
var BAR_SPEED=3;
var COLOR_STEP=0.01;
var nextColorIndex=0;
var MAX_ANGLE = Math.PI / 32;
var angle = MAX_ANGLE;
var angleAdjust = Math.PI / 3600;

var backgroundImage = new Image();
backgroundImage.src="../../assets/grid.png";

var shootingObject = new Image();
shootingObject.src="../../assets/Tank.gif"

var bulletImg = new Image();
bulletImg.src="../../assets/bullet.png";

var nbullets=0;
var initNbullet=0;
var x,y;

bulletArray = new Array();

activeColor= new Color(0,0,255);
	
	colors = new Array();
	colors[0]=(new Color(200, 160, 150));
	colors[1]=(new Color(230, 160, 90));
	colors[2]=(new Color(230, 240, 90));
	colors[3]=(new Color(100, 240, 190));
	colors[4]=(new Color(100, 170, 220));
	colors[5]=(new Color(200, 100, 220));

function init(){
	ctx=document.getElementById("backgroundCanvas").getContext('2d');
	
	drawScene();
	setInterval(drawScene,0);
}

function clear(){
	  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); //Erasing the Canvas
}

function clearColor(){
	  ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height); //Filling the Canvas
}

function hitToken(event){

var keyCode; //Hold keyCode
if(event == null) { //If event null
keyCode = window.event.keyCode; //Get keyCode using window.event
Window.event.preventDefault(); //Stop default action
} 
else { 
keyCode = event.keyCode; 
event.preventDefault(); 
} 
//alert(" You just pressed keycode "+keyCode);
bulletArray.push(new Bullet(ctx.canvas.width/2-3, ctx.canvas.height-95));
nbullets++;
}

function drawScene()
{
    ctx.drawImage(backgroundImage, 0, 0, 800,500,0,0, ctx.canvas.width, ctx.canvas.height);
    ctx.globalAlpha = 1;
	ctx.drawImage(shootingObject, 0, 0, 45,48 ,ctx.canvas.width/2-20, ctx.canvas.height-80,45,48);
	
	window.addEventListener('keydown',hitToken,false);
	bullets();
	// Moving through the color array
	if (activeColor.fadeTo(colors[nextColorIndex])) {
	activeColor = colors[nextColorIndex++];
	if (nextColorIndex >= colors.length) {
		nextColorIndex = 0;
	}
    }
	
	//Opacity for the background
	ctx.globalAlpha = 0.8;
    
    ctx.fillStyle = 'rgb(' + activeColor.getRGB() + ')';	
	clearColor();
	
	ctx.save(); // Rotation is being always performed about centre. Therefore we save state before rotation and restore it later.
	ctx.globalAlpha = 0.3; //opacity for bars
	//translate and rotate the canvas
    ctx.translate(ctx.canvas.width / 2, ctx.canvas.height / 2);
	ctx.rotate(angle += angleAdjust);
	//draw bars and update coordinates for next time.
	bars();
	
	ctx.restore();//restore the canvas to original position.
}

function bars(){

    

for (var i = topOffset; i < ctx.canvas.height + 600; i += (BAR_HEIGHT * 2)) {
	//still hv to decide width for rotation.. right now (widht/2+200)<->(600).
	//vertical drawing is (300)<->(300) the screen area.
	ctx.fillRect(0 - (ctx.canvas.width / 2) - 200,i - (ctx.canvas.height / 2) ,ctx.canvas.width + 600, BAR_HEIGHT );
}
    //update the angle of rotation
	if (angle > MAX_ANGLE || angle < 0 - MAX_ANGLE) {
		angleAdjust = 0 - angleAdjust;
	}

topOffset -= BAR_SPEED;
if (topOffset + BAR_HEIGHT * 2 + 300 < 0) {
	topOffset += BAR_HEIGHT * 2;
}
}

function bullets(){
var tempLength=bulletArray.length;
for(var j=initNbullet;j<tempLength;j++)
{
	ctx.drawImage(bulletImg, 0, 0, 300,300 ,bulletArray[j].x,bulletArray[j].y,15,15);
	bulletArray[j].y-=2;
	if(bulletArray[j].y<=50)  // To-Do Add code for collision Detection
	{
	    bulletArray.splice(j,1); // Probably add link list here or use two indexes to refer starting and beginning.
		nbullets--;
	}
}
}

function Bullet(x,y){
this.x=x;
this.y=y;
}

function Color(r,g,b) {
	this.r = r;
	this.g = g;
	this.b = b;
 
	this.step = COLOR_STEP;

	this.fadeTo = function(color) {
		this.r = this.r + ((color.r - this.r) * this.step);
		this.g = this.g + ((color.g - this.g) * this.step);
		this.b = this.b + ((color.b - this.b) * this.step);
 
		this.step += COLOR_STEP;
 
		if (this.r == color.r &&
				this.g == color.g &&
				this.b == color.b) {
 
			this.step = COLOR_STEP;
			return true;
		}
		return false;
	}
 
	this.getRGB = function() {
		return Math.round(this.r) + "," +
				Math.round(this.g) + "," +
				Math.round(this.b);
	}
}

</script>
</head>

<body onLoad=init()>
	 <div id="backgroundHolder">
	 	 <canvas id="backgroundCanvas" width="600" height="600"></canvas>
	 </div>
	 <div id="realbody">
	 	 <!-- Content -->
	 </div>
</body>

</html>
